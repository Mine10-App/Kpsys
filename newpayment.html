<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payment Entry</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .container { max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    .totals { margin-top: 20px; font-size: 18px; }
    .totals span { font-weight: bold; }
    #receipt { display: none; margin-top: 20px; padding: 20px; border: 1px solid #ccc; }
    .receipt-divider { border-top: 1px dashed #aaa; margin: 10px 0; }
    .receipt-total { font-size: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Payment Entry</h2>

    <label>Passenger Name</label>
    <input type="text" id="passengerName">

    <label>Flight</label>
    <input type="text" id="flight">

    <label>Seat</label>
    <input type="text" id="seat">

    <label>Adults</label>
    <input type="number" id="adultCount" value="0" min="0">

    <label>Kids</label>
    <input type="number" id="kidCount" value="0" min="0">

    <label>Rate</label>
    <select id="rate">
      <option value="A">Rate A</option>
      <option value="B">Rate B</option>
    </select>

    <label>Currency</label>
    <select id="currency">
      <option value="USD">USD</option>
      <option value="MVR">MVR</option>
    </select>

    <label>Payment Type</label>
    <select id="paymentType">
      <option value="Cash">Cash</option>
      <option value="Card">Card</option>
    </select>

    <label>Paid Amount (if Cash)</label>
    <input type="number" id="paidAmount" value="0">

    <label>Balance</label>
    <input type="text" id="balanceAmount" readonly>

    <div class="totals">
      <p>Subtotal: <span id="rateField">$0.00</span></p>
      <p>GST: <span id="gstField">$0.00</span></p>
      <p>Total: <span id="totalField">$0.00</span></p>
    </div>

    <button id="saveBtn">Process Payment</button>

    <div id="receipt">
      <h3>Receipt</h3>
      <div id="receiptBody"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="rate.js"></script>
  <script>
    // Calculate totals using rate.js
    function calculateTotals() {
      const adults = parseInt(document.getElementById("adultCount").value) || 0;
      const kids = parseInt(document.getElementById("kidCount").value) || 0;
      const rateType = document.getElementById("rate").value;
      const currency = document.getElementById("currency").value;

      const adultKey = `Adult${rateType}${currency}`;
      const kidKey = `Kids${rateType}${currency}`;

      const adultRate = rates[adultKey];
      const kidRate = rates[kidKey];

      let subtotal = (adults * adultRate.price) + (kids * kidRate.price);
      let gst = subtotal * (adultRate.GST / 100);
      let total = subtotal + gst;

      document.getElementById("rateField").textContent = `${currency} ${subtotal.toFixed(2)}`;
      document.getElementById("gstField").textContent = `${currency} ${gst.toFixed(2)}`;
      document.getElementById("totalField").textContent = `${currency} ${total.toFixed(2)}`;

      if (document.getElementById("paymentType").value === "Cash") {
        const paid = parseFloat(document.getElementById("paidAmount").value) || 0;
        document.getElementById("balanceAmount").value = (paid - total).toFixed(2);
      } else {
        document.getElementById("balanceAmount").value = "0.00";
      }

      return { subtotal, gst, total, currency };
    }

    // Attach events
    ["adultCount", "kidCount", "rate", "currency", "paymentType", "paidAmount"]
      .forEach(id => document.getElementById(id).addEventListener("input", calculateTotals));

    // Save button â†’ show receipt
    document.getElementById("saveBtn").addEventListener("click", () => {
      const name = document.getElementById("passengerName").value || "N/A";
      const flight = document.getElementById("flight").value || "N/A";
      const seat = document.getElementById("seat").value || "N/A";
      const paymentType = document.getElementById("paymentType").value;
      const totals = calculateTotals();

      const receiptBody = document.getElementById("receiptBody");
      receiptBody.innerHTML = `
        <p>Receipt No: ${Math.floor(Math.random() * 100000)}</p>
        <p>Date: ${new Date().toLocaleDateString()}</p>
        <p>Passenger: ${name}</p>
        <p>Flight: ${flight}</p>
        <p>Seat: ${seat}</p>
        <p>Adults: ${document.getElementById('adultCount').value}</p>
        <p>Kids: ${document.getElementById('kidCount').value}</p>
        <div class="receipt-divider"></div>
        <p>Payment Type: ${paymentType}</p>
        <p>Currency: ${totals.currency}</p>
        <p class="receipt-total">Total: ${totals.currency} ${totals.total.toFixed(2)}</p>
        <div class="receipt-divider"></div>
        <p>Processed by: System User</p>
      `;
      document.getElementById("receipt").style.display = "block";
    });

    // Initial calculation
    calculateTotals();
  </script>
</body>
</html>
